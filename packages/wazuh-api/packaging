set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

tar -xvzf ${BOSH_COMPILE_TARGET}/wazuh/wazuh-api-2.1.1.tar.gz

mkdir -p ${BOSH_INSTALL_TARGET}/api

cp -a ${BOSH_COMPILE_TARGET}/wazuh-api-2.1.1/* ${BOSH_INSTALL_TARGET}/api

export PATH=$PATH:/var/vcap/packages/nodejs/node/bin/
pushd ${BOSH_INSTALL_TARGET}/api
npm install --production
mkdir -pm 700 framework/lib
gcc -pipe -O2 -shared -fPIC -o framework/lib/libsqlite3.so.0 framework/database/sqlite3.c
popd
